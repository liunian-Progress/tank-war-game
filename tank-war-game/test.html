<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¦å…‹å¤§æˆ˜æ¸¸æˆ - æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }
        
        .game-section {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .game-info {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }
        
        .controls {
            flex: 1;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: scale(1.05);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
        }
        
        .log {
            background: rgba(0, 0, 0, 0.7);
            padding: 15px;
            border-radius: 8px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            margin: 15px 0;
        }
        
        .input-group {
            margin: 10px 0;
        }
        
        input {
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            width: 200px;
        }
        
        input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .feature-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #4ecdc4;
        }
        
        .feature-card h3 {
            margin-top: 0;
            color: #4ecdc4;
        }
        
        .api-section {
            margin-top: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 10px;
        }
        
        .api-endpoint {
            background: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš— å¤šäººåœ¨çº¿å¦å…‹å¤§æˆ˜æ¸¸æˆ</h1>
        
        <div class="game-section">
            <div class="game-info">
                <h3>ğŸ® æ¸¸æˆä¿¡æ¯</h3>
                <div class="status" id="gameStatus">
                    çŠ¶æ€: æœªè¿æ¥<br>
                    ç©å®¶æ•°: 0<br>
                    æˆ¿é—´æ•°: 0
                </div>
                
                <div class="input-group">
                    <input type="text" id="playerName" placeholder="è¾“å…¥ç©å®¶æ˜µç§°" maxlength="10">
                    <button onclick="connectToGame()">è¿æ¥æ¸¸æˆ</button>
                </div>
                
                <div class="button-group">
                    <button onclick="createRoom()">åˆ›å»ºæˆ¿é—´</button>
                    <button onclick="quickMatch()">å¿«é€ŸåŒ¹é…</button>
                    <button onclick="getLeaderboard()">æŸ¥çœ‹æ’è¡Œæ¦œ</button>
                    <button onclick="getRoomList()">æˆ¿é—´åˆ—è¡¨</button>
                </div>
            </div>
            
            <div class="controls">
                <h3>ğŸ¯ æ¸¸æˆæ§åˆ¶</h3>
                <div class="button-group">
                    <button onclick="testMove('up')">â†‘ å‘ä¸Š</button>
                    <button onclick="testMove('down')">â†“ å‘ä¸‹</button>
                    <button onclick="testMove('left')">â† å‘å·¦</button>
                    <button onclick="testMove('right')">â†’ å‘å³</button>
                </div>
                
                <div class="button-group">
                    <button onclick="testShoot()">ğŸ”« å°„å‡»</button>
                    <button onclick="testChat()">ğŸ’¬ å‘é€æ¶ˆæ¯</button>
                    <button onclick="disconnect()">æ–­å¼€è¿æ¥</button>
                </div>
                
                <div class="input-group">
                    <input type="text" id="chatMessage" placeholder="è¾“å…¥èŠå¤©æ¶ˆæ¯" maxlength="50">
                </div>
            </div>
        </div>
        
        <div class="log" id="messageLog">
            <div>ğŸ“ ç³»ç»Ÿæ—¥å¿—:</div>
        </div>
        
        <div class="feature-list">
            <div class="feature-card">
                <h3>ğŸ® æ ¸å¿ƒåŠŸèƒ½</h3>
                <ul>
                    <li>å¤šäººåœ¨çº¿å®æ—¶å¯¹æˆ˜</li>
                    <li>WebSocketå®æ—¶é€šä¿¡</li>
                    <li>Canvasæ¸¸æˆç”»é¢æ¸²æŸ“</li>
                    <li>ç¢°æ’æ£€æµ‹ç³»ç»Ÿ</li>
                    <li>ç”Ÿå‘½å€¼å’Œå¾—åˆ†ç³»ç»Ÿ</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>ğŸ  æˆ¿é—´ç³»ç»Ÿ</h3>
                <ul>
                    <li>æˆ¿é—´åˆ›å»ºå’Œç®¡ç†</li>
                    <li>å¿«é€ŸåŒ¹é…åŠŸèƒ½</li>
                    <li>æˆ¿é—´çŠ¶æ€ç›‘æ§</li>
                    <li>ç©å®¶è¿›å‡ºé€šçŸ¥</li>
                    <li>æˆ¿é—´åˆ—è¡¨æŸ¥çœ‹</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>ğŸ’¬ ç¤¾äº¤åŠŸèƒ½</h3>
                <ul>
                    <li>å®æ—¶èŠå¤©ç³»ç»Ÿ</li>
                    <li>å¤šç§æ’è¡Œæ¦œ</li>
                    <li>ç©å®¶ç»Ÿè®¡æ•°æ®</li>
                    <li>èŠå¤©å†å²è®°å½•</li>
                    <li>ç³»ç»Ÿæ¶ˆæ¯é€šçŸ¥</li>
                </ul>
            </div>
            
            <div class="feature-card">
                <h3>ğŸ—ºï¸ åœ°å›¾ç³»ç»Ÿ</h3>
                <ul>
                    <li>å¤šç§åœ°å›¾ç±»å‹</li>
                    <li>éšæœºéšœç¢ç‰©ç”Ÿæˆ</li>
                    <li>é“å…·ç³»ç»Ÿ</li>
                    <li>åŸºåœ°ä¿æŠ¤æœºåˆ¶</li>
                    <li>å¯ç ´åç¯å¢ƒ</li>
                </ul>
            </div>
        </div>
        
        <div class="api-section">
            <h3>ğŸ”Œ APIæ¥å£æµ‹è¯•</h3>
            <div class="api-endpoint">GET /api/rooms - è·å–æˆ¿é—´åˆ—è¡¨</div>
            <div class="api-endpoint">POST /api/rooms/create - åˆ›å»ºæˆ¿é—´</div>
            <div class="api-endpoint">POST /api/rooms/quick-match - å¿«é€ŸåŒ¹é…</div>
            <div class="api-endpoint">GET /api/leaderboard/all - è·å–æ’è¡Œæ¦œ</div>
            <div class="api-endpoint">GET /api/chat/history - è·å–èŠå¤©å†å²</div>
            <div class="api-endpoint">WebSocket: ws://localhost:8080/tank-war</div>
        </div>
    </div>
    
    <script>
        let socket = null;
        let playerId = null;
        let playerName = '';
        
        function log(message) {
            const logElement = document.getElementById('messageLog');
            const timestamp = new Date().toLocaleTimeString();
            logElement.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function updateStatus(status) {
            document.getElementById('gameStatus').innerHTML = status;
        }
        
        function connectToGame() {
            playerName = document.getElementById('playerName').value.trim();
            if (!playerName) {
                alert('è¯·è¾“å…¥ç©å®¶æ˜µç§°ï¼');
                return;
            }
            
            try {
                socket = new WebSocket('ws://localhost:8080/tank-war');
                
                socket.onopen = function() {
                    log('âœ… è¿æ¥åˆ°æœåŠ¡å™¨æˆåŠŸ');
                    updateStatus(`çŠ¶æ€: å·²è¿æ¥<br>ç©å®¶: ${playerName}<br>æˆ¿é—´: ç­‰å¾…ä¸­`);
                    
                    // å‘é€åŠ å…¥æ¸¸æˆæ¶ˆæ¯
                    sendMessage({
                        type: 'join',
                        playerName: playerName
                    });
                };
                
                socket.onmessage = function(event) {
                    const message = JSON.parse(event.data);
                    handleServerMessage(message);
                };
                
                socket.onclose = function() {
                    log('âŒ ä¸æœåŠ¡å™¨è¿æ¥æ–­å¼€');
                    updateStatus('çŠ¶æ€: è¿æ¥æ–­å¼€<br>ç©å®¶: æ— <br>æˆ¿é—´: æ— ');
                };
                
                socket.onerror = function(error) {
                    log('âŒ WebSocketè¿æ¥é”™è¯¯: ' + error);
                };
                
            } catch (error) {
                log('âŒ è¿æ¥å¤±è´¥: ' + error.message);
                alert('æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿æœåŠ¡å™¨å·²å¯åŠ¨ï¼');
            }
        }
        
        function sendMessage(message) {
            if (socket && socket.readyState === WebSocket.OPEN) {
                socket.send(JSON.stringify(message));
                log('ğŸ“¤ å‘é€: ' + JSON.stringify(message));
            } else {
                log('âŒ æ— æ³•å‘é€æ¶ˆæ¯ï¼Œè¿æ¥æœªå»ºç«‹');
            }
        }
        
        function handleServerMessage(message) {
            log('ğŸ“¥ æ¥æ”¶: ' + JSON.stringify(message));
            
            switch (message.type) {
                case 'playerId':
                    playerId = message.playerId;
                    log('ğŸ® è·å¾—ç©å®¶ID: ' + playerId);
                    break;
                case 'playerJoined':
                    log('ğŸ‘‹ ç©å®¶åŠ å…¥: ' + message.playerName);
                    break;
                case 'playerLeft':
                    log('ğŸ‘‹ ç©å®¶ç¦»å¼€: ' + message.playerName);
                    break;
                case 'chatMessage':
                    log('ğŸ’¬ ' + message.playerName + ': ' + message.text);
                    break;
                case 'gameState':
                    log('ğŸ¯ æ¸¸æˆçŠ¶æ€æ›´æ–°');
                    break;
            }
        }
        
        function createRoom() {
            if (!socket) {
                alert('è¯·å…ˆè¿æ¥æ¸¸æˆï¼');
                return;
            }
            
            fetch('/api/rooms/create', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    name: playerName + 'çš„æˆ¿é—´',
                    maxPlayers: 8
                })
            })
            .then(response => response.json())
            .then(data => {
                log('ğŸ  æˆ¿é—´åˆ›å»ºæˆåŠŸ: ' + data.name);
            })
            .catch(error => {
                log('âŒ åˆ›å»ºæˆ¿é—´å¤±è´¥: ' + error);
            });
        }
        
        function quickMatch() {
            if (!socket) {
                alert('è¯·å…ˆè¿æ¥æ¸¸æˆï¼');
                return;
            }
            
            fetch('/api/rooms/quick-match', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    playerName: playerName
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    log('ğŸ¯ å¿«é€ŸåŒ¹é…æˆåŠŸ');
                } else {
                    log('âŒ å¿«é€ŸåŒ¹é…å¤±è´¥: ' + data.message);
                }
            })
            .catch(error => {
                log('âŒ å¿«é€ŸåŒ¹é…å¤±è´¥: ' + error);
            });
        }
        
        function getLeaderboard() {
            fetch('/api/leaderboard/all')
            .then(response => response.json())
            .then(data => {
                log('ğŸ† æ’è¡Œæ¦œæ•°æ®: ' + JSON.stringify(data));
            })
            .catch(error => {
                log('âŒ è·å–æ’è¡Œæ¦œå¤±è´¥: ' + error);
            });
        }
        
        function getRoomList() {
            fetch('/api/rooms')
            .then(response => response.json())
            .then(data => {
                log('ğŸ  æˆ¿é—´åˆ—è¡¨: ' + JSON.stringify(data));
            })
            .catch(error => {
                log('âŒ è·å–æˆ¿é—´åˆ—è¡¨å¤±è´¥: ' + error);
            });
        }
        
        function testMove(direction) {
            if (!socket || !playerId) {
                alert('è¯·å…ˆè¿æ¥æ¸¸æˆï¼');
                return;
            }
            
            const directions = {
                'up': 0,
                'right': 1,
                'down': 2,
                'left': 3
            };
            
            sendMessage({
                type: 'move',
                playerId: playerId,
                data: {
                    x: 100,
                    y: 100,
                    direction: directions[direction]
                }
            });
        }
        
        function testShoot() {
            if (!socket || !playerId) {
                alert('è¯·å…ˆè¿æ¥æ¸¸æˆï¼');
                return;
            }
            
            sendMessage({
                type: 'shoot',
                playerId: playerId,
                data: {
                    x: 100,
                    y: 100,
                    direction: 0
                }
            });
        }
        
        function testChat() {
            const message = document.getElementById('chatMessage').value.trim();
            if (!message) {
                alert('è¯·è¾“å…¥èŠå¤©æ¶ˆæ¯ï¼');
                return;
            }
            
            if (!socket || !playerId) {
                alert('è¯·å…ˆè¿æ¥æ¸¸æˆï¼');
                return;
            }
            
            sendMessage({
                type: 'chat',
                playerId: playerId,
                playerName: playerName,
                text: message
            });
            
            document.getElementById('chatMessage').value = '';
        }
        
        function disconnect() {
            if (socket) {
                socket.close();
                socket = null;
                playerId = null;
                log('ğŸ”Œ ä¸»åŠ¨æ–­å¼€è¿æ¥');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸš€ å¦å…‹å¤§æˆ˜æ¸¸æˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
            log('ğŸ’¡ æç¤º: è¯·å…ˆå¯åŠ¨åç«¯æœåŠ¡å™¨ï¼Œç„¶åè¾“å…¥æ˜µç§°è¿æ¥æ¸¸æˆ');
        });
    </script>
</body>
</html>
